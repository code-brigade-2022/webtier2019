<!DOCTYPE html>
<html lang="en">

<head>

    <title>IATA Distance Calculator</title>

    <!-- Includes the external Bootstrap CSS library into the html -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.12.1/datatables.min.css" />

    <!-- Adding a customized CSS styling from the customStyleSheet.css file -->
    <link rel="stylesheet" href="css/customStyleSheet.css" />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="mockdata/airports.js"></script>
    <script type="text/javascript" src="mockdata/distance.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.12.1/datatables.min.js"></script>
</head>

<body>
    <header>
        <div class="overlay"></div>
        <video playsinline="playsinline" autoplay="autoplay" muted="muted" loop="loop">
            <!-- Here is the video header source -->
            <source src="media/copa_puntuality.mp4" type="video/mp4" />
        </video>
        <div class="container h-100">
            <div class="d-flex h-100 text-center align-items-center">
                <div class="w-100 text-white">
                    <h1 class="display-2">Greetings Players</h1>
                    <h4 class="display-0">Welcome to COPA AWS Hackathon</h4>
                </div>
            </div>
        </div>
        </div>
    </header>

    <!-- Here is the main Section of the WebPage -->
    <section>
        <div class="card text-center">
            <div class="card-body">
                <br />

                <h3>Airport Descriptions</h3>

                <br />

                <table class="table table-hover" id="airports_table">
                    <thead class="thead-primary">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">IATA</th>
                            <th scope="col">Airport</th>
                            <th scope="col">Location</th>
                        </tr>
                    </thead>
                    <tbody id="bodytableAirport"></tbody>
                </table>

                <br />
                <br />
                <!-- Calculation Distance -->
                <div class="calulate-distance-form">
                    <H3>Calculate Distance</H3>
                    <div class="form-group">
                        <form id="distanceForm">
                            <input class="form-input" type="text" id="origin" name="origin" placeholder="Origin IATA" />
                            &nbsp;
                            <input class="form-input" type="text" id="destination" name="destination"
                                placeholder="Destination IATA" />
                            &nbsp;
                            <input type="submit" id="calculate-distance" name="calculate-distance" class="btn btn-info"
                                value="Calculate" />
                        </form>
                    </div>

                    <!-- Result -->
                    <div class="card card-custom">
                        <span id="cardDistanceResult" class="alert-info">
                            <div id="distanceResult" class="card-body">
                                In order to calculate the distance from one Airport to
                                another, just write the Origin IATA airport and the
                                destination IATA Airport above.
                            </div>
                        </span>
                    </div>
                </div>

                <br />
                <br />
                <br />

                <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img class="" src="media/belize.jpg" alt="First slide" height="600" width="1425">
                        </div>
                        <div class="carousel-item">
                            <img class="" src="media/salvador.jpg" alt="Second slide" height="600" width="1425">
                        </div>
                        <div class="carousel-item">
                            <img class="" src="media/surinam.jpg" alt="Third slide" height="600" width="1425">
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
</body>

<script>

    /* -------------------- Obtaining airports -------------------- */

    $(document).ready(function () {
        getAirports();
    });

    function getAirports() {
        let airportsURL = "http://copatry.brazilsouth.cloudapp.azure.com/airports"

        fetch(airportsURL)
            .then((response) => response.json())
            .then((data) => {
                // console.log(data["airports"]);
                fillAirportsTable(data["airports"]);
            })
            .catch((error) => {
                console.log("Could not retrieve airports: " + error);
                fillAirportsTable(airports);
            });
    }

    function fillAirportsTable(airportList) {
        var airports_table = $('#airports_table').DataTable({
            columnDefs: [
                { className: "text-center", targets: [0, 1, 2, 3] },
            ]
        }
        );
        $.each(airportList, function (key, value) {
            airports_table.row.add([key + 1, value.IATA, value.Airport, value.Location]).draw(false);
        });
    }

    /* -------------------- Obtaining distance -------------------- */

    $(document).on("click", "#calculate-distance", function (event) {
        event.preventDefault();

        // Reading User Input data
        let origin = document.getElementById("origin").value.trim().toUpperCase();
        let destination = document.getElementById("destination").value.trim().toUpperCase();

        // Creating a variable to hold our future calculated result
        let distanceResult = "";
        let resultText = "";
        let classResultText = "alert-info";

        // Validation:
        let empty_input = (origin != null) & (origin !== "") & (destination != null) & (destination !== "");
        if (empty_input) {
            // Inputs are not empty:
            if (origin == destination) {
                // Inputs are the same:
                updateResult(
                    resultText = `The distance from ${origin} to ${destination} is 0 miles.`,
                    classResultText = "alert-warning"
                );
            } else {
                // Correct inputs:
                let distanceResult = fetchDistance(origin, destination);
                distanceResult.then((res) => {
                    if (parseInt(res) > 0) {
                        updateResult(
                            resultText = `The distance from ${origin} to ${destination} is ${res} miles.`,
                            classResultText = "alert-success"
                        );
                    } else {
                        updateResult(
                            resultText = `No distance information has been found for: \n Origin: ${origin} \n Destination: ${destination}.`,
                            classResultText = "alert-danger"
                        );
                    }
                })
            }
        } else {
            // Inputs are empty:
            updateResult(
                resultText = "Please introduce some valid information for both origin and destination.",
                classResultText = "alert-danger"
            );
        }

    });

    // Get airports distance information:

    function fetchDistance(orig, dest) {
        let host = 'localhost:3000' // copatry.brazilsouth.cloudapp.azure.com
        let distanceURL = `http://${host}/distance?orig=${orig}&dest=${dest}`;

        return fetch(distanceURL)
            .then((response) => response.json())
            .then((data) => {
                return data[0]["MILES"];
            })
            .catch((error) => {
                console.log(error);
                return "0";
            });
    }

    // Update result text displayed to users:

    function updateResult(resultText, classResultText) {
        $("#cardDistanceResult").removeClass();
        $("#cardDistanceResult").addClass(classResultText);
        $("#distanceResult").text(resultText);
    }

</script>

</html>